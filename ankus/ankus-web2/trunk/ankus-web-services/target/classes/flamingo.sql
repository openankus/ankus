CREATE DATABASE IF NOT EXISTS FLAMINGO DEFAULT CHARACTER SET UTF8 COLLATE UTF8_GENERAL_CI;

CREATE TABLE IF NOT EXISTS ENGINE (
  ID         INT(11) NOT NULL AUTO_INCREMENT COMMENT 'Sequence',
  NAME       VARCHAR(64) DEFAULT NULL COMMENT 'Workflow Engine Name',
  IP         VARCHAR(256) COMMENT 'Workflow Engine IP',
  PORT       VARCHAR(256) COMMENT 'Workflow Engine Port',
  CLUSTER_ID INT(11) COMMENT 'Hadoop Cluster ID',
  HIVE_ID    INT(11) COMMENT 'Hive Server ID',
  PRIMARY KEY (ID)
)
  ENGINE =InnoDB
  DEFAULT CHARSET = UTF8;

CREATE TABLE IF NOT EXISTS ADMIN_HIVE_SERVER (
  ID             INT(11) NOT NULL AUTO_INCREMENT COMMENT 'Sequence',
  NAME           VARCHAR(64) DEFAULT NULL COMMENT 'Hive Server Name',
  JDBC_DRIVER    VARCHAR(256) COMMENT 'JDBC Driver',
  JDBC_URL       VARCHAR(256) COMMENT 'JDBC URL',
  METASTORE_URIS VARCHAR(256) COMMENT 'Hive Metastore Thrift URIs',
  PRIMARY KEY (ID)
)
  ENGINE =InnoDB
  DEFAULT CHARSET = UTF8;

ALTER TABLE ADMIN_HIVE_SERVER
ADD COLUMN METASTORE_USER VARCHAR(256) NULL AFTER JDBC_URL,
ADD COLUMN METASTORE_PASSWORD VARCHAR(256) NULL AFTER METASTORE_USER;

UPDATE ADMIN_HIVE_SERVER
SET METASTORE_USER = 'root',
  METASTORE_PASSWORD = 'root'
WHERE ID = 1;

CREATE TABLE IF NOT EXISTS ADMIN_HADOOP_CLUSTER (
  ID            INT(11) NOT NULL AUTO_INCREMENT COMMENT 'Sequence',
  NAME          VARCHAR(64) DEFAULT NULL COMMENT 'Hadoop Cluster Name',
  NN_PROTOCOL   VARCHAR(10) COMMENT 'Namenode Protocol (s3n, hdfs)',
  NN_IP         VARCHAR(20) COMMENT 'Namenode IP Address',
  NN_PORT       INT(11) COMMENT 'Namenode Port',
  HDFS_URL      VARCHAR(256) COMMENT 'HDFS URL',
  JT_IP         VARCHAR(20) COMMENT 'Job Tracker IP Address',
  JT_PORT       INT(11) COMMENT 'Job Tracker Port',
  NN_CONSOLE    VARCHAR(256) COMMENT 'Namenode Console URL',
  JT_CONSOLE    VARCHAR(256) COMMENT 'Job Tracker Console URL',
  NN_THRIFT_URL VARCHAR(256) COMMENT 'Namenode Thrift URL',
  JT_THRIFT_URL VARCHAR(256) COMMENT 'Job Tracker Thrift URL',
  PRIMARY KEY (ID)
)
  ENGINE =InnoDB
  DEFAULT CHARSET = UTF8;

ALTER TABLE ADMIN_HADOOP_CLUSTER ADD (JT_MONITORING_PORT INT(5) COMMENT 'Job Tracker Monitoring Port');
ALTER TABLE ADMIN_HADOOP_CLUSTER ADD (NN_MONITORING_PORT INT(5) COMMENT 'Namenode Monitoring Port');

ALTER TABLE ADMIN_HADOOP_CLUSTER DROP COLUMN NN_THRIFT_URL;
ALTER TABLE ADMIN_HADOOP_CLUSTER DROP COLUMN JT_THRIFT_URL;

CREATE TABLE IF NOT EXISTS PIG (
  ID          INT(11)      NOT NULL AUTO_INCREMENT COMMENT 'Sequence',
  USERNAME    VARCHAR(64)  NOT NULL COMMENT 'User Name',
  SCRIPT_NAME VARCHAR(256) NOT NULL COMMENT 'Script Name',
  SCRIPT      BLOB COMMENT 'Script',
  CREATE_DATE TIMESTAMP DEFAULT CURRENT_TIMESTAMP COMMENT 'Created Time',
  PRIMARY KEY (ID)
)
  ENGINE =InnoDB
  DEFAULT CHARSET = UTF8;

CREATE TABLE IF NOT EXISTS HIVE (
  ID          INT(11)      NOT NULL AUTO_INCREMENT COMMENT 'Sequence',
  SERVER_ID   INT(11)      NOT NULL COMMENT 'Hive Server ID',
  USERNAME    VARCHAR(64)  NOT NULL COMMENT 'User Name',
  NAME        VARCHAR(256) NOT NULL COMMENT 'Script Name',
  SCRIPT      BLOB COMMENT 'Script',
  VARIABLE    VARCHAR(256) COMMENT 'Variables in script',
  LIBRARY     VARCHAR(256) COMMENT 'External JAR Library',
  CONF        VARCHAR(256) COMMENT 'Hadoop Configuration',
  DESCRIPTION VARCHAR(250) COMMENT 'Description',
  START_AT    TIMESTAMP DEFAULT CURRENT_TIMESTAMP COMMENT 'Query Execution Start Time',
  FINISHED_AT TIMESTAMP DEFAULT 0 COMMENT 'Query Execution End Time',
  STATUS      VARCHAR(16) COMMENT 'Query Execution Status',
  PRIMARY KEY (ID),
  FOREIGN KEY (SERVER_ID) REFERENCES ADMIN_HIVE_SERVER (ID)
)
  ENGINE = InnoDB
  DEFAULT CHARSET = UTF8;

CREATE TABLE IF NOT EXISTS USER (
  USERNAME       VARCHAR(64)  NOT NULL COMMENT 'Login name',
  PASSWD         VARCHAR(64)  NOT NULL COMMENT 'Password',
  NAME           VARCHAR(250) NOT NULL COMMENT 'User name',
  EMAIL          VARCHAR(250) NOT NULL COMMENT 'Email Address',
  ENABLED        BOOLEAN      NOT NULL DEFAULT TRUE COMMENT 'Account Enabled',
  AC_NON_EXPIRED BOOLEAN      NOT NULL DEFAULT TRUE COMMENT 'Account Non-expired',
  AC_NON_LOCKED  BOOLEAN      NOT NULL DEFAULT TRUE COMMENT 'Account Non-locked',
  CR_NON_EXPIRED BOOLEAN      NOT NULL DEFAULT TRUE COMMENT 'Credential Non-expired',
  AUTHORITY      VARCHAR(250) NOT NULL DEFAULT 'ROLE_USER' COMMENT 'User Authority',
  CREATE_DT      TIMESTAMP DEFAULT CURRENT_TIMESTAMP COMMENT 'Workflow Varialbe',
  LAST_LOGIN     TIMESTAMP COMMENT 'LAST LOGIN TIME'
  PRIMARY KEY (USERNAME)
)
  ENGINE =InnoDB
  DEFAULT CHARSET = UTF8;

ALTER TABLE USER ADD (CREATE_DT TIMESTAMP DEFAULT CURRENT_TIMESTAMP COMMENT 'Workflow Varialbe');

INSERT INTO USER (USERNAME, PASSWD, NAME, EMAIL, ENABLED, AC_NON_EXPIRED, AC_NON_LOCKED, CR_NON_EXPIRED, AUTHORITY)
  VALUES ('admin', 'admin', 'cloudine', 'cloudine@cloudine.co.kr', 1, 1, 1, 1, 'ROLE_USER');

CREATE TABLE IF NOT EXISTS TREE (
  ID        INT(11)      NOT NULL AUTO_INCREMENT COMMENT 'Sequence',
  NAME      VARCHAR(250) NOT NULL COMMENT 'Name',
  TREE      VARCHAR(10)  NOT NULL COMMENT 'Tree Type',
  NODE      VARCHAR(10)  NOT NULL COMMENT 'Node Type',
  ROOT      BOOLEAN      NULL DEFAULT FALSE COMMENT 'Username',
  USERNAME  VARCHAR(50)  NOT NULL COMMENT 'Username',
  PARENT_ID INT(11) DEFAULT NULL COMMENT 'Parent',
  FOREIGN KEY (PARENT_ID) REFERENCES TREE (ID),
  PRIMARY KEY (ID)
)
  ENGINE = InnoDB
  DEFAULT CHARSET = UTF8;

INSERT INTO TREE VALUES (1, '/', 'WORKFLOW', 'FOLDER', TRUE, 'admin', null);


CREATE TABLE IF NOT EXISTS WORKFLOW (
  ID           INT(11)      NOT NULL AUTO_INCREMENT COMMENT 'Sequence',
  WORKFLOW_ID  VARCHAR(60)  NOT NULL COMMENT 'Workflow String ID',
  NAME         VARCHAR(250) NOT NULL COMMENT 'Workflow Name',
  DESCRIPTION  VARCHAR(250) DEFAULT '' COMMENT 'Description',
  VARIABLE     BLOB DEFAULT NULL COMMENT 'Workflow Varialbe',
  WORKFLOW_XML BLOB         NOT NULL COMMENT 'Workflow XML',
  DESIGNER_XML BLOB         NOT NULL COMMENT 'Designer XML',
  CREATE_DT    TIMESTAMP DEFAULT CURRENT_TIMESTAMP COMMENT 'Workflow Varialbe',
  STATUS       VARCHAR(10)  NOT NULL COMMENT 'Workflow Varialbe',
  TREE_ID      INT(11)      NOT NULL COMMENT 'Tree ID',
  USERNAME     VARCHAR(50)  NOT NULL COMMENT 'Writer',
  PRIMARY KEY (ID)
)
  ENGINE = InnoDB
  DEFAULT CHARSET = UTF8;

CREATE TABLE IF NOT EXISTS MONITORING (
  ID        VARCHAR(30) NOT NULL COMMENT 'Timestamp based Sequence',
  CREATE_DT TIMESTAMP COMMENT 'Create Date',
  YEAR      INT(4) DEFAULT NULL COMMENT 'Year of Create Date',
  MONTH     INT(2) DEFAULT NULL COMMENT 'Month of Create Date',
  DAY       INT(2) DEFAULT NULL COMMENT 'Day of Create Date',
  HOUR      INT(2) DEFAULT NULL COMMENT 'Hour of Create Date',
  ENGINE    INT(11) DEFAULT NULL COMMENT 'Workflow Engine',
  HADOOP    INT(11) DEFAULT NULL COMMENT 'Apache Hadoop Cluster',
  HIVE      INT(11) DEFAULT NULL COMMENT 'Apache Hive Server',
  TYPE      VARCHAR(20) COMMENT 'Metrics Type',
  INTERV    VARCHAR(20) COMMENT 'Interval',
  VALUE1    VARCHAR(200) DEFAULT '' COMMENT 'Value1',
  VALUE2    VARCHAR(200) DEFAULT '' COMMENT 'Value2',
  VALUE3    VARCHAR(200) DEFAULT '' COMMENT 'Value3',
  VALUE4    VARCHAR(200) DEFAULT '' COMMENT 'Value4',
  VALUE5    BIGINT DEFAULT NULL COMMENT 'Value5',
  VALUE6    BIGINT DEFAULT NULL COMMENT 'Value6',
  VALUE7    BIGINT DEFAULT NULL COMMENT 'Value7',
  VALUE8    BIGINT DEFAULT NULL COMMENT 'Value8',
  VALUE9    BIGINT DEFAULT NULL COMMENT 'Value9',
  VALUE10   BIGINT DEFAULT NULL COMMENT 'Value10',
  VALUE11   BIGINT DEFAULT NULL COMMENT 'Value11',
  VALUE12   BIGINT DEFAULT NULL COMMENT 'Value12',
  PRIMARY KEY (ID)
)
  ENGINE =InnoDB
  DEFAULT CHARSET = UTF8;

CREATE TABLE IF NOT EXISTS ANKUS_CODE (
  seq          INT(3)       NOT NULL COMMENT 'Sequence',
  codegroup        VARCHAR(3)    NOT NULL COMMENT 'Code Group',
  groupname    VARCHAR(50)   NOT NULL COMMENT 'Group Name',
  code         VARCHAR(3)    NOT NULL COMMENT 'Code',
  codename     VARCHAR(50)   NOT NULL COMMENT 'Code Name',
  description  VARCHAR(100)    NULL   COMMENT 'Code Description',
  vercheck        VARCHAR(1)      NULL   COMMENT 'version Check',
  create_dt    VARCHAR(8)    NOT NULL COMMENT 'Create Date',
  modify_dt    VARCHAR(8)      NULL   COMMENT 'Modify Date',
  PRIMARY KEY (seq)
)
ENGINE = InnoDB
DEFAULT CHARSET = UTF8;

INSERT INTO ANKUS_CODE (SEQ, CODEGROUP, GROUPNAME, CODE, CODENAME, DESCRIPTION, VERCHECK, CREATE_DT, MODIFY_DT)
  VALUES ('1', 'A01', 'JAR', '0', 'version', '', 'N', '20150305', '');
INSERT INTO ANKUS_CODE (SEQ, CODEGROUP, GROUPNAME, CODE, CODENAME, DESCRIPTION, VERCHECK, CREATE_DT, MODIFY_DT)
  VALUES (2, 'A01', 'JAR', '1', 'org.ankus:ankus-core:0.1', '', 'N', '20150305', '');
INSERT INTO ANKUS_CODE (SEQ, CODEGROUP, GROUPNAME, CODE, CODENAME, DESCRIPTION, VERCHECK, CREATE_DT, MODIFY_DT)
  VALUES (3, 'A01', 'JAR', '2', 'org.ankus:ankus-core:0.2.2', '', 'N', '20150305', '');
INSERT INTO ANKUS_CODE (SEQ, CODEGROUP, GROUPNAME, CODE, CODENAME, DESCRIPTION, VERCHECK, CREATE_DT, MODIFY_DT)
  VALUES (4, 'A01', 'JAR', '3', 'org.ankus:ankus-core:0.3.0', '', 'Y', '20150305', '');